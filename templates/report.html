<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ ui.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(135deg, #e3f2fd, #f9f9f9);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            animation: fadeIn 1s ease-in-out;
        }

        .card {
            border-radius: 15px;
            border: none;
            background: #fff;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: slideUp 0.7s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        h2 {
            color: #0d6efd;
            font-weight: bold;
            text-align: center;
            animation: glow 2s infinite alternate;
        }

        h5 {
            color: #343a40;
            border-left: 4px solid #0d6efd;
            padding-left: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        h5:hover {
            border-left: 4px solid #198754;
            color: #198754;
            transform: translateX(5px);
        }

        p, li {
            font-size: 15px;
            color: #555;
        }

        ul {
            list-style-type: none;
            padding-left: 0;
        }

        ul li {
            position: relative;
            padding-left: 25px;
            margin-bottom: 5px;
            transition: transform 0.2s ease;
        }

        ul li::before {
            content: "‚úîÔ∏è";
            position: absolute;
            left: 0;
        }

        ul li:hover {
            transform: scale(1.05);
            color: #0d6efd;
        }

        .btn-primary {
            background: #0d6efd;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(13,110,253,0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-primary:hover {
            background: #084298;
            box-shadow: 0 6px 20px rgba(13,110,253,0.6);
            transform: scale(1.05);
        }

        .btn-primary::after {
            content: "";
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #0d6efd;
            border-radius: inherit;
            animation: pulseOutline 2s infinite;
        }

        .btn-secondary, .btn-success {
            border-radius: 25px;
            padding: 10px 20px;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #495057;
            color: white;
            transform: scale(1.05);
        }

        .btn-success:hover {
            transform: scale(1.05);
        }

        .form-select {
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .form-select:hover {
            border-color: #0d6efd;
            box-shadow: 0 0 5px rgba(13,110,253,0.6);
        }

        /* Floating audio player */
        #audioPlayerBox {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 8px 18px rgba(0,0,0,0.15);
            padding: 15px;
            display: none;
            width: 300px;
            animation: slideUp 0.6s ease;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes glow {
            from { text-shadow: 0 0 5px #0d6efd; }
            to { text-shadow: 0 0 15px #0d6efd, 0 0 25px #0d6efd; }
        }

        @keyframes pulseOutline {
            0% { opacity: 0; transform: scale(0.9); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0; transform: scale(0.9); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .card {
                padding: 20px;
            }
            h2 {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>

<div class="container mt-4">
    <div class="card shadow p-4">
        <h2 class="mb-4">{{ ui.title }}</h2>

        <!-- Patient Info -->
        <div class="mb-3">
            <h5>Patient ID: {{ patient_id }}</h5>
            <!-- Diagnosis removed -->
            <p><strong>Risks:</strong> {{ report["risk_level"]["explanation"] }}</p>
        </div>

        <!-- Language selector -->
        <form method="post" action="{{ url_for('report_bp.change_language') }}" class="mb-3">
            <input type="hidden" name="patient_id" value="{{ patient_id }}">
            <label for="preferred_language"><strong>{{ ui.language_label }}:</strong></label>
            <select name="preferred_language" onchange="this.form.submit()" class="form-select w-auto d-inline-block ms-2">
                {% for lang in langs %}
                    <option value="{{ lang }}" {% if lang == current_lang %}selected{% endif %}>{{ lang }}</option>
                {% endfor %}
            </select>
        </form>

        <!-- Report sections -->


        <div class="mb-4 section-box p-3 rounded border">
            <h5>{{ ui.risk }}</h5>
            <p>{{ report["risk_level"]["explanation"] }}</p>
            <ul>
                {% for item in report["risk_level"]["things_to_watch"] %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>

        <div class="mb-4 section-box p-3 rounded border">
            <h5>{{ ui.follow_up }}</h5>
            <ul>
                {% for appt in report["follow_up_plan"] %}
                    <li>{{ appt["appointment"] }} - {{ appt["date"] }}: {{ appt["instructions"] }}</li>
                {% endfor %}
            </ul>
        </div>

        <div class="mb-4 section-box p-3 rounded border">
            <h5>{{ ui.monitoring }}</h5>
            <ul>
                {% for w in report["monitoring"]["weight_check"] %}
                    <li>{{ w }}</li>
                {% endfor %}
                {% for s in report["monitoring"]["symptoms_to_watch"] %}
                    <li>{{ s }}</li>
                {% endfor %}
            </ul>
        </div>

        <div class="mb-4 section-box p-3 rounded border">
            <h5>{{ ui.tips }}</h5>
            <ul>
                {% for tip in report["tips"] %}
                    <li>{{ tip }}</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Buttons -->
        <div class="d-flex gap-2">
            <button class="btn btn-primary" onclick="loadAudio()">üîä {{ ui.listen }}</button>
            <a class="btn btn-secondary"
               href="{{ url_for('report_bp.download_pdf', patient_id=patient_id) }}">
                ‚¨áÔ∏è {{ ui.print_btn }}
            </a>
            <a class="btn btn-success"
               href="{{ url_for('report_bp.send_report', patient_id=patient_id) }}">
                üìß Send Report
            </a>
        </div>
    </div>
</div>

<!-- Floating Audio Player -->
<div id="audioPlayerBox">
    <h6 class="text-primary">üîä {{ ui.listen }}</h6>
    <audio id="reportAudio" controls class="w-100">
        <source src="{{ url_for('report_bp.audio', patient_id=patient_id, lang=current_lang) }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
</div>

<script>
    function loadAudio() {
        let playerBox = document.getElementById("audioPlayerBox");
        let audio = document.getElementById("reportAudio");
        playerBox.style.display = "block";
        audio.play();
    }
</script>

</body>
</html>
